{
  "$schema": "../../../schemas/hooks.schema.json",
  "version": "2.0.0",
  "plugin": "home-assistant-architect",
  "description": "Scoped event-driven hooks for Home Assistant and Ollama workflows",
  "hooks": [
    {
      "id": "userpromptsubmit-1",
      "event": "UserPromptSubmit",
      "severity": "advisory",
      "description": "UserPromptSubmit hook",
      "trigger": {
        "scope": "prompt",
        "prompt_patterns": [
          "(^|\\s)/(ha-control|ha-automation|ha-deploy|ha-diagnose|ha-voice|ha-backup|ha-mcp|ollama-setup)\\b|\\b(home assistant|hass|homeassistant|configuration\\.ya?ml|automations?\\.ya?ml|secrets\\.ya?ml|scenes\\.ya?ml|scripts\\.ya?ml|assist_pipeline)\\b|\\bmcp__home_assistant__"
        ]
      },
      "handlers": [
        {
          "type": "prompt",
          "severity": "info",
          "debounce_key": "ha-userprompt-context",
          "debounce_scope": "session",
          "debounce_window_seconds": 900,
          "prompt": "Handle Home Assistant intent only when the user references HA-specific commands, HA config files, HA domains/entities, or Home Assistant MCP tools. Do not trigger on generic verbs (for example: set, adjust, turn on) without HA context.",
          "doc_ref": "docs/hooks/prompt-guidance.md"
        }
      ]
    },
    {
      "id": "pretooluse-2",
      "event": "PreToolUse",
      "severity": "block",
      "description": "PreToolUse hook",
      "trigger": {
        "scope": "tool",
        "tools": [
          "Write|Edit|MultiEdit"
        ]
      },
      "handlers": [
        {
          "type": "prompt",
          "severity": "high",
          "debounce_key": "ha-yaml-prewrite",
          "debounce_scope": "session",
          "debounce_window_seconds": 300,
          "prompt": "Before editing Home Assistant YAML, validate syntax and key HA structures (trigger/condition/action, service calls, entity_id, secrets references). Skip this reminder for non-HA files.",
          "doc_ref": "docs/hooks/prompt-guidance.md"
        }
      ],
      "metadata": {
        "conditions": {
          "path_any": [
            "**/configuration.yaml",
            "**/secrets.yaml",
            "**/automations.yaml",
            "**/scripts.yaml",
            "**/scenes.yaml",
            "**/blueprints/**/*.yaml",
            "**/packages/**/*.yaml",
            "**/homeassistant/**/*.yaml"
          ]
        }
      }
    },
    {
      "id": "pretooluse-3",
      "event": "PreToolUse",
      "severity": "warn",
      "description": "PreToolUse hook",
      "trigger": {
        "scope": "tool",
        "tools": [
          "Bash"
        ]
      },
      "handlers": [
        {
          "type": "prompt",
          "severity": "medium",
          "debounce_key": "ha-bash-domain-safety",
          "debounce_scope": "session",
          "debounce_window_seconds": 300,
          "prompt": "For HA/Ollama shell commands only: verify target host, auth token usage, and service impact before execution. Do not emit for unrelated Bash commands."
        }
      ],
      "metadata": {
        "conditions": {
          "command_any": [
            "*ha core*",
            "*ha addons*",
            "*ha supervisor*",
            "*hass*",
            "*homeassistant*",
            "*docker*homeassistant*",
            "*ollama*",
            "*curl*api/states*",
            "*curl*api/services*"
          ]
        }
      }
    },
    {
      "id": "posttooluse-4",
      "event": "PostToolUse",
      "severity": "warn",
      "description": "PostToolUse hook",
      "trigger": {
        "scope": "tool",
        "tools": [
          "Bash"
        ]
      },
      "handlers": [
        {
          "type": "prompt",
          "severity": "medium",
          "debounce_key": "ha-post-bash-health",
          "debounce_scope": "session",
          "debounce_window_seconds": 600,
          "prompt": "After HA/Ollama commands, check service health/state once per debounce window (HA core status, API responsiveness, and Ollama model/service availability)."
        }
      ],
      "metadata": {
        "conditions": {
          "command_any": [
            "*ollama*",
            "*ha core*",
            "*ha supervisor*",
            "*homeassistant*"
          ]
        }
      }
    },
    {
      "id": "posttooluse-5",
      "event": "PostToolUse",
      "severity": "block",
      "description": "PostToolUse hook",
      "trigger": {
        "scope": "tool",
        "tools": [
          "Write|Edit|MultiEdit"
        ]
      },
      "handlers": [
        {
          "type": "prompt",
          "severity": "high",
          "debounce_key": "ha-postwrite-security",
          "debounce_scope": "session",
          "debounce_window_seconds": 600,
          "prompt": "Review Home Assistant config edits for security and reliability (secret leakage, unsafe external URLs/commands, privileged add-ons, and invalid entity/service references)."
        }
      ],
      "metadata": {
        "conditions": {
          "path_any": [
            "**/configuration.yaml",
            "**/secrets.yaml",
            "**/automations.yaml",
            "**/scripts.yaml",
            "**/scenes.yaml",
            "**/blueprints/**/*.yaml",
            "**/packages/**/*.yaml",
            "**/homeassistant/**/*.yaml"
          ]
        }
      }
    },
    {
      "id": "taskcompleted-6",
      "event": "TaskCompleted",
      "severity": "advisory",
      "description": "TaskCompleted hook",
      "trigger": {
        "scope": "task",
        "command_patterns": [
          "ha-deploy|ha-automation|ha-config|ollama-setup"
        ]
      },
      "handlers": [
        {
          "type": "prompt",
          "severity": "info",
          "debounce_key": "ha-task-healthcheck",
          "debounce_scope": "session",
          "debounce_window_seconds": 900,
          "prompt": "Run focused health checks only after HA/Ollama task types (ha-deploy, ha-automation, ha-config, ollama-setup)."
        }
      ]
    },
    {
      "id": "sessionend-7",
      "event": "SessionEnd",
      "severity": "advisory",
      "description": "SessionEnd hook",
      "trigger": {
        "scope": "session"
      },
      "handlers": [
        {
          "type": "prompt",
          "severity": "info",
          "debounce_key": "ha-session-backup-reminder",
          "debounce_scope": "session",
          "debounce_window_seconds": 3600,
          "prompt": "If significant HA configuration changed this session, remind once to backup configuration.yaml, automations, and secrets securely."
        }
      ]
    }
  ],
  "settings": {},
  "metadata": {
    "scripts_dir": "scripts",
    "log_level": "info"
  }
}
