{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Orchestration Event Schemas",
  "version": "1.0.0",
  "definitions": {
    "BaseEvent": {
      "type": "object",
      "required": [
        "event_id",
        "event_type",
        "event_version",
        "timestamp",
        "event_sequence",
        "issue_key",
        "session_id",
        "actor",
        "metadata"
      ],
      "properties": {
        "event_id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique event identifier (UUID v4)"
        },
        "event_type": {
          "type": "string",
          "enum": [
            "OrchestrationStarted",
            "OrchestrationCompleted",
            "OrchestrationFailed",
            "OrchestrationPaused",
            "OrchestrationResumed",
            "PhaseStarted",
            "PhaseCompleted",
            "PhaseFailed",
            "AgentSpawned",
            "AgentCompleted",
            "AgentFailed",
            "AgentBlocked",
            "GapIdentified",
            "GapResolved",
            "GapEscalated",
            "CommitCreated",
            "PRCreated",
            "PRMerged",
            "PRClosed",
            "IssueTransitioned",
            "CommentPosted",
            "WorklogAdded",
            "DocumentationCreated",
            "ConfluencePageCreated",
            "QualityCheckStarted",
            "QualityCheckCompleted",
            "QualityCheckFailed",
            "TestRunStarted",
            "TestRunCompleted",
            "TestRunFailed",
            "CheckpointCreated",
            "CheckpointRestored",
            "ErrorOccurred",
            "RecoveryAttempted",
            "RecoverySucceeded",
            "RecoveryFailed"
          ]
        },
        "event_version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Schema version (semver)"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO-8601 timestamp with milliseconds"
        },
        "event_sequence": {
          "type": "integer",
          "minimum": 0,
          "description": "Monotonic sequence number per session"
        },
        "issue_key": {
          "type": "string",
          "pattern": "^[A-Z]+-\\d+$",
          "description": "Jira issue key"
        },
        "session_id": {
          "type": "string",
          "format": "uuid",
          "description": "Orchestration session UUID"
        },
        "correlation_id": {
          "type": "string",
          "format": "uuid",
          "description": "Link related events"
        },
        "causation_id": {
          "type": "string",
          "format": "uuid",
          "description": "Event that caused this event"
        },
        "actor": {
          "type": "object",
          "required": ["type", "id"],
          "properties": {
            "type": {
              "type": "string",
              "enum": ["user", "system", "agent"]
            },
            "id": {
              "type": "string",
              "description": "User ID, system component, or agent name"
            },
            "model": {
              "type": "string",
              "enum": ["opus", "sonnet", "haiku"]
            }
          }
        },
        "metadata": {
          "type": "object",
          "description": "Event-specific data"
        },
        "git_sha": {
          "type": "string",
          "pattern": "^[a-f0-9]{40}$",
          "description": "Git commit SHA at time of event"
        },
        "branch": {
          "type": "string",
          "description": "Git branch"
        },
        "codebase_state": {
          "type": "string",
          "description": "Hash of relevant codebase state"
        }
      }
    },
    "OrchestrationStarted": {
      "allOf": [
        {"$ref": "#/definitions/BaseEvent"},
        {
          "properties": {
            "event_type": {"const": "OrchestrationStarted"},
            "metadata": {
              "type": "object",
              "required": [
                "issue_key",
                "issue_summary",
                "issue_type",
                "priority",
                "workflow_type",
                "initial_phase"
              ],
              "properties": {
                "issue_key": {"type": "string"},
                "issue_summary": {"type": "string"},
                "issue_type": {"type": "string"},
                "priority": {"type": "string"},
                "labels": {"type": "array", "items": {"type": "string"}},
                "components": {"type": "array", "items": {"type": "string"}},
                "workflow_type": {"type": "string"},
                "estimated_complexity": {"type": "string", "enum": ["low", "medium", "high"]},
                "initial_phase": {"type": "string"},
                "config": {"type": "object"}
              }
            }
          }
        }
      ]
    },
    "AgentSpawned": {
      "allOf": [
        {"$ref": "#/definitions/BaseEvent"},
        {
          "properties": {
            "event_type": {"const": "AgentSpawned"},
            "metadata": {
              "type": "object",
              "required": [
                "agent_name",
                "agent_type",
                "agent_model",
                "spawn_reason",
                "assigned_task"
              ],
              "properties": {
                "agent_name": {"type": "string"},
                "agent_type": {"type": "string"},
                "agent_category": {"type": "string"},
                "agent_model": {"type": "string", "enum": ["opus", "sonnet", "haiku"]},
                "spawn_reason": {"type": "string"},
                "assigned_task": {"type": "string"},
                "assigned_files": {"type": "array", "items": {"type": "string"}},
                "expected_outputs": {"type": "array", "items": {"type": "string"}},
                "dependencies": {"type": "array", "items": {"type": "string"}},
                "priority": {"type": "string"},
                "timeout_seconds": {"type": "integer"}
              }
            }
          }
        }
      ]
    },
    "CommitCreated": {
      "allOf": [
        {"$ref": "#/definitions/BaseEvent"},
        {
          "properties": {
            "event_type": {"const": "CommitCreated"},
            "metadata": {
              "type": "object",
              "required": [
                "commit_sha",
                "commit_message",
                "files_changed"
              ],
              "properties": {
                "commit_sha": {"type": "string"},
                "commit_message": {"type": "string"},
                "files_changed": {"type": "integer"},
                "insertions": {"type": "integer"},
                "deletions": {"type": "integer"},
                "changed_files": {"type": "array", "items": {"type": "string"}},
                "smart_commit": {"type": "boolean"},
                "jira_transition": {"type": "string"},
                "agent_author": {"type": "string"},
                "validation_passed": {"type": "boolean"}
              }
            }
          }
        }
      ]
    },
    "GapIdentified": {
      "allOf": [
        {"$ref": "#/definitions/BaseEvent"},
        {
          "properties": {
            "event_type": {"const": "GapIdentified"},
            "metadata": {
              "type": "object",
              "required": [
                "gap_id",
                "gap_type",
                "severity",
                "phase",
                "description"
              ],
              "properties": {
                "gap_id": {"type": "string"},
                "gap_type": {"type": "string"},
                "severity": {"type": "string", "enum": ["low", "medium", "high", "critical"]},
                "phase": {"type": "string"},
                "description": {"type": "string"},
                "affected_modules": {"type": "array", "items": {"type": "string"}},
                "impact": {"type": "string"},
                "identified_by": {"type": "string"},
                "recommended_actions": {"type": "array", "items": {"type": "string"}},
                "estimated_effort": {"type": "string"},
                "blocking": {"type": "boolean"}
              }
            }
          }
        }
      ]
    }
  },
  "event_types": {
    "orchestration_lifecycle": [
      "OrchestrationStarted",
      "OrchestrationCompleted",
      "OrchestrationFailed",
      "OrchestrationPaused",
      "OrchestrationResumed"
    ],
    "phase_lifecycle": [
      "PhaseStarted",
      "PhaseCompleted",
      "PhaseFailed"
    ],
    "agent_lifecycle": [
      "AgentSpawned",
      "AgentCompleted",
      "AgentFailed",
      "AgentBlocked"
    ],
    "gap_management": [
      "GapIdentified",
      "GapResolved",
      "GapEscalated"
    ],
    "git_operations": [
      "CommitCreated",
      "PRCreated",
      "PRMerged",
      "PRClosed"
    ],
    "jira_integration": [
      "IssueTransitioned",
      "CommentPosted",
      "WorklogAdded"
    ],
    "documentation": [
      "DocumentationCreated",
      "ConfluencePageCreated"
    ],
    "quality_assurance": [
      "QualityCheckStarted",
      "QualityCheckCompleted",
      "QualityCheckFailed",
      "TestRunStarted",
      "TestRunCompleted",
      "TestRunFailed"
    ],
    "state_management": [
      "CheckpointCreated",
      "CheckpointRestored"
    ],
    "error_recovery": [
      "ErrorOccurred",
      "RecoveryAttempted",
      "RecoverySucceeded",
      "RecoveryFailed"
    ]
  },
  "metadata": {
    "created": "2025-12-22",
    "author": "event-sourcing-orchestrator",
    "description": "JSON schemas for all orchestration event types"
  }
}
