# Runbook: {{SERVICE_NAME}}

## Service Information

| Field | Value |
|-------|-------|
| **Service Name** | {{SERVICE_NAME}} |
| **Owner Team** | {{OWNER_TEAM}} |
| **On-Call Rotation** | {{ONCALL_ROTATION}} |
| **Slack Channel** | {{SLACK_CHANNEL}} |
| **Jira Project** | {{JIRA_PROJECT}} |
| **Repository** | {{REPO_URL}} |
| **Last Updated** | {{LAST_UPDATED}} |

## Quick Reference

### URLs

- **Production**: {{PROD_URL}}
- **Staging**: {{STAGING_URL}}
- **Documentation**: {{DOCS_URL}}
- **Monitoring Dashboard**: {{MONITORING_URL}}
- **Logs Dashboard**: {{LOGS_URL}}

### Kubernetes

```bash
# Namespace
kubectl get pods -n {{NAMESPACE}}

# View logs
kubectl logs -f deployment/{{DEPLOYMENT_NAME}} -n {{NAMESPACE}}

# Describe pod
kubectl describe pod {{POD_NAME}} -n {{NAMESPACE}}

# Scale deployment
kubectl scale deployment/{{DEPLOYMENT_NAME}} --replicas={{REPLICAS}} -n {{NAMESPACE}}
```

### Database

- **Connection String**: {{DB_CONNECTION_STRING}}
- **Read Replica**: {{DB_READ_REPLICA}}
- **Admin Tool**: {{DB_ADMIN_URL}}

### Cache

- **Redis Endpoint**: {{REDIS_ENDPOINT}}
- **Cache Dashboard**: {{CACHE_DASHBOARD_URL}}

## Health Checks

### Service Health

```bash
# Health endpoint
curl {{HEALTH_ENDPOINT}}

# Expected response
{{EXPECTED_HEALTH_RESPONSE}}
```

### Dependency Health

| Dependency | Health Check | Expected Response |
|------------|--------------|-------------------|
| {{DEP_1}} | {{CHECK_1}} | {{RESPONSE_1}} |
| {{DEP_2}} | {{CHECK_2}} | {{RESPONSE_2}} |
| {{DEP_3}} | {{CHECK_3}} | {{RESPONSE_3}} |

### Key Metrics

```promql
# Request rate
{{REQUEST_RATE_QUERY}}

# Error rate
{{ERROR_RATE_QUERY}}

# Latency p95
{{LATENCY_P95_QUERY}}

# CPU usage
{{CPU_USAGE_QUERY}}

# Memory usage
{{MEMORY_USAGE_QUERY}}
```

## Common Incidents

### Incident: High Error Rate

**Symptoms:**
- {{SYMPTOM_1}}
- {{SYMPTOM_2}}

**Diagnosis:**
```bash
# Check error logs
{{ERROR_LOG_COMMAND}}

# Check downstream services
{{DEPENDENCY_CHECK_COMMAND}}

# Check database connections
{{DB_CONNECTION_CHECK}}
```

**Resolution:**
1. {{RESOLUTION_STEP_1}}
2. {{RESOLUTION_STEP_2}}
3. {{RESOLUTION_STEP_3}}

**Prevention:** {{PREVENTION_MEASURES}}

---

### Incident: High Latency

**Symptoms:**
- {{SYMPTOM_1}}
- {{SYMPTOM_2}}

**Diagnosis:**
```bash
# Check slow queries
{{SLOW_QUERY_COMMAND}}

# Check cache hit rate
{{CACHE_HIT_RATE_COMMAND}}

# Check resource utilization
{{RESOURCE_CHECK_COMMAND}}
```

**Resolution:**
1. {{RESOLUTION_STEP_1}}
2. {{RESOLUTION_STEP_2}}
3. {{RESOLUTION_STEP_3}}

**Prevention:** {{PREVENTION_MEASURES}}

---

### Incident: Service Unavailable

**Symptoms:**
- {{SYMPTOM_1}}
- {{SYMPTOM_2}}

**Diagnosis:**
```bash
# Check pod status
kubectl get pods -n {{NAMESPACE}}

# Check recent deployments
kubectl rollout history deployment/{{DEPLOYMENT_NAME}} -n {{NAMESPACE}}

# Check events
kubectl get events -n {{NAMESPACE}} --sort-by='.lastTimestamp'
```

**Resolution:**
1. {{RESOLUTION_STEP_1}}
2. {{RESOLUTION_STEP_2}}
3. {{RESOLUTION_STEP_3}}

**Prevention:** {{PREVENTION_MEASURES}}

---

### Incident: Database Connection Pool Exhaustion

**Symptoms:**
- {{SYMPTOM_1}}
- {{SYMPTOM_2}}

**Diagnosis:**
```bash
# Check connection pool metrics
{{POOL_METRICS_COMMAND}}

# Check active queries
{{ACTIVE_QUERIES_COMMAND}}

# Check long-running transactions
{{LONG_RUNNING_TX_COMMAND}}
```

**Resolution:**
1. {{RESOLUTION_STEP_1}}
2. {{RESOLUTION_STEP_2}}
3. {{RESOLUTION_STEP_3}}

**Prevention:** {{PREVENTION_MEASURES}}

---

### Incident: Cache Invalidation Issues

**Symptoms:**
- {{SYMPTOM_1}}
- {{SYMPTOM_2}}

**Diagnosis:**
```bash
# Check cache hit rate
{{CACHE_HIT_COMMAND}}

# Check cache size
{{CACHE_SIZE_COMMAND}}

# Check eviction rate
{{EVICTION_RATE_COMMAND}}
```

**Resolution:**
1. {{RESOLUTION_STEP_1}}
2. {{RESOLUTION_STEP_2}}
3. {{RESOLUTION_STEP_3}}

**Prevention:** {{PREVENTION_MEASURES}}

## Deployment Procedures

### Standard Deployment

```bash
# 1. Verify staging deployment
{{STAGING_VERIFY_COMMAND}}

# 2. Deploy to production
{{DEPLOY_COMMAND}}

# 3. Monitor deployment
kubectl rollout status deployment/{{DEPLOYMENT_NAME}} -n {{NAMESPACE}}

# 4. Verify health
{{HEALTH_CHECK_COMMAND}}
```

### Rollback Procedure

```bash
# 1. Identify last good version
kubectl rollout history deployment/{{DEPLOYMENT_NAME}} -n {{NAMESPACE}}

# 2. Rollback
kubectl rollout undo deployment/{{DEPLOYMENT_NAME}} -n {{NAMESPACE}}

# 3. Monitor rollback
kubectl rollout status deployment/{{DEPLOYMENT_NAME}} -n {{NAMESPACE}}

# 4. Verify health
{{HEALTH_CHECK_COMMAND}}
```

### Feature Flag Rollout

```bash
# Enable feature for canary
{{FEATURE_FLAG_CANARY_COMMAND}}

# Monitor canary metrics
{{CANARY_METRICS_COMMAND}}

# Enable for all users
{{FEATURE_FLAG_ENABLE_COMMAND}}
```

## Scaling Procedures

### Horizontal Scaling

```bash
# Scale up
kubectl scale deployment/{{DEPLOYMENT_NAME}} --replicas={{NEW_REPLICAS}} -n {{NAMESPACE}}

# Monitor scaling
kubectl get hpa -n {{NAMESPACE}}

# Verify distribution
kubectl get pods -n {{NAMESPACE}} -o wide
```

### Vertical Scaling

```yaml
# Update resource limits
resources:
  requests:
    cpu: {{CPU_REQUEST}}
    memory: {{MEMORY_REQUEST}}
  limits:
    cpu: {{CPU_LIMIT}}
    memory: {{MEMORY_LIMIT}}
```

### Database Scaling

{{DATABASE_SCALING_PROCEDURE}}

## Monitoring

### Dashboards

| Dashboard | URL | Purpose |
|-----------|-----|---------|
| {{DASHBOARD_1}} | {{URL_1}} | {{PURPOSE_1}} |
| {{DASHBOARD_2}} | {{URL_2}} | {{PURPOSE_2}} |
| {{DASHBOARD_3}} | {{URL_3}} | {{PURPOSE_3}} |

### Alerts

| Alert | Severity | Threshold | Action |
|-------|----------|-----------|--------|
| {{ALERT_1}} | Critical/Warning | {{THRESHOLD_1}} | {{ACTION_1}} |
| {{ALERT_2}} | Critical/Warning | {{THRESHOLD_2}} | {{ACTION_2}} |
| {{ALERT_3}} | Critical/Warning | {{THRESHOLD_3}} | {{ACTION_3}} |

### SLIs/SLOs

| SLI | SLO | Current | Status |
|-----|-----|---------|--------|
| {{SLI_1}} | {{SLO_1}} | {{CURRENT_1}} | {{STATUS_1}} |
| {{SLI_2}} | {{SLO_2}} | {{CURRENT_2}} | {{STATUS_2}} |
| {{SLI_3}} | {{SLO_3}} | {{CURRENT_3}} | {{STATUS_3}} |

## Maintenance

### Regular Tasks

| Task | Frequency | Owner | Last Completed |
|------|-----------|-------|----------------|
| {{TASK_1}} | {{FREQ_1}} | {{OWNER_1}} | {{DATE_1}} |
| {{TASK_2}} | {{FREQ_2}} | {{OWNER_2}} | {{DATE_2}} |
| {{TASK_3}} | {{FREQ_3}} | {{OWNER_3}} | {{DATE_3}} |

### Database Maintenance

```bash
# Run vacuum (if PostgreSQL)
{{VACUUM_COMMAND}}

# Rebuild indexes
{{REBUILD_INDEX_COMMAND}}

# Update statistics
{{UPDATE_STATS_COMMAND}}
```

### Cache Maintenance

```bash
# Flush cache
{{CACHE_FLUSH_COMMAND}}

# Warm cache
{{CACHE_WARM_COMMAND}}
```

## Disaster Recovery

### Backup Verification

```bash
# Verify latest backup
{{BACKUP_VERIFY_COMMAND}}

# List recent backups
{{BACKUP_LIST_COMMAND}}
```

### Restore Procedure

1. {{RESTORE_STEP_1}}
2. {{RESTORE_STEP_2}}
3. {{RESTORE_STEP_3}}

### Failover Procedure

1. {{FAILOVER_STEP_1}}
2. {{FAILOVER_STEP_2}}
3. {{FAILOVER_STEP_3}}

## Security

### Secrets Rotation

```bash
# Rotate API key
{{API_KEY_ROTATION_COMMAND}}

# Rotate database password
{{DB_PASSWORD_ROTATION_COMMAND}}

# Rotate certificates
{{CERT_ROTATION_COMMAND}}
```

### Access Review

**Last Review:** {{LAST_ACCESS_REVIEW}}

**Next Review:** {{NEXT_ACCESS_REVIEW}}

## Contact & Escalation

### Escalation Path

1. **L1 - On-Call Engineer**: {{ONCALL_CONTACT}}
2. **L2 - Team Lead**: {{TEAM_LEAD_CONTACT}}
3. **L3 - Engineering Manager**: {{ENG_MANAGER_CONTACT}}
4. **L4 - VP Engineering**: {{VP_ENG_CONTACT}}

### External Contacts

| Vendor | Contact | Purpose |
|--------|---------|---------|
| {{VENDOR_1}} | {{CONTACT_1}} | {{PURPOSE_1}} |
| {{VENDOR_2}} | {{CONTACT_2}} | {{PURPOSE_2}} |

## Documentation

- **Architecture**: {{ARCHITECTURE_DOC_URL}}
- **API Docs**: {{API_DOCS_URL}}
- **TDD**: {{TDD_URL}}
- **ADRs**: {{ADRS_URL}}
- **Confluence**: {{CONFLUENCE_URL}}

## Change Log

| Date | Change | Author |
|------|--------|--------|
| {{DATE_1}} | {{CHANGE_1}} | {{AUTHOR_1}} |
| {{DATE_2}} | {{CHANGE_2}} | {{AUTHOR_2}} |

---

**âš“ Golden Armada** | *You ask - The Fleet Ships*
