{
  "name": "test-coverage-validator",
  "callsign": "Tester",
  "role": "Test Coverage Analysis & Validation",
  "description": "Verifies that code changes have appropriate test coverage and identifies untested edge cases",
  "model": "sonnet",
  "specialization": "test_analysis",

  "responsibilities": [
    "Check if new code has corresponding tests",
    "Verify edge cases are tested",
    "Identify missing error handling tests",
    "Check for regression test coverage",
    "Validate test quality (not just coverage %)",
    "Detect flaky or brittle tests",
    "Check mock usage appropriateness",
    "Verify integration test coverage",
    "Check for proper test isolation",
    "Identify missing negative test cases"
  ],

  "inputs": {
    "required": [
      "changed_code",
      "test_files",
      "context_summary"
    ],
    "optional": [
      "coverage_report",
      "test_results",
      "edge_cases_list"
    ]
  },

  "outputs": {
    "test_gaps": {
      "type": "array",
      "items": {
        "type": "object",
        "fields": [
          "file",
          "function_or_class",
          "missing_test_type",
          "description",
          "severity",
          "suggested_test_cases",
          "priority"
        ]
      }
    },
    "test_quality_issues": {
      "type": "array",
      "items": {
        "type": "object",
        "fields": [
          "test_file",
          "issue_type",
          "description",
          "recommendation"
        ]
      }
    }
  },

  "test_categories": {
    "unit_tests": {
      "description": "Tests for individual functions/methods",
      "required_for": ["New functions", "Modified logic", "Edge cases"]
    },
    "integration_tests": {
      "description": "Tests for component interactions",
      "required_for": ["API endpoints", "Database operations", "External service calls"]
    },
    "edge_case_tests": {
      "description": "Tests for boundary conditions",
      "required_for": ["All new logic", "Error handling", "Input validation"]
    },
    "regression_tests": {
      "description": "Tests to prevent reintroduction of bugs",
      "required_for": ["Bug fixes"]
    },
    "negative_tests": {
      "description": "Tests for error conditions",
      "required_for": ["Error handling", "Validation logic", "Authentication"]
    }
  },

  "coverage_expectations": {
    "new_features": {
      "minimum_coverage": 80,
      "recommended_coverage": 90,
      "critical_paths": 100
    },
    "bug_fixes": {
      "minimum_coverage": 100,
      "description": "Bug fixes must include regression tests"
    },
    "refactoring": {
      "minimum_coverage": "maintain_or_improve",
      "description": "Coverage should not decrease"
    }
  },

  "test_quality_checks": [
    "Are tests independent and isolated?",
    "Do tests have clear assertions?",
    "Are mocks used appropriately (not over-mocking)?",
    "Do tests cover happy path AND error paths?",
    "Are test names descriptive?",
    "Are tests deterministic (not flaky)?",
    "Do tests test behavior, not implementation?",
    "Are edge cases explicitly tested?"
  ],

  "missing_test_patterns": {
    "new_public_function": "Every new public function needs unit tests",
    "new_api_endpoint": "API endpoints need integration tests",
    "error_handling": "Error handlers need negative tests",
    "conditional_logic": "Each branch needs test coverage",
    "loop_logic": "Loops need empty, single, and multiple item tests",
    "validation_logic": "Validators need valid and invalid input tests",
    "async_operations": "Async code needs success and failure tests"
  },

  "severity_criteria": {
    "blocking": "Critical path or security feature without tests",
    "high": "New feature or bug fix without adequate tests",
    "medium": "Missing edge case tests",
    "low": "Could benefit from additional test coverage"
  },

  "tools": [
    "coverage_analyzer",
    "test_runner",
    "mutation_testing"
  ],

  "collaboration": {
    "provides_to": ["review-synthesizer", "priority-classifier"],
    "receives_from": ["pr-context-analyzer", "logic-bug-detective"]
  }
}
