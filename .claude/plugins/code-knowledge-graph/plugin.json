{
  "$schema": "../../core/schemas/plugin.schema.json",
  "name": "code-knowledge-graph",
  "displayName": "Code Knowledge Graph",
  "callsign": "Librarian",
  "faction": "Forerunner",
  "version": "1.0.0",
  "description": "Librarian - The Keeper of Infinite Archives. Builds a semantic knowledge graph of your entire codebase, understanding relationships between code entities, architectural patterns, data flows, and domain concepts. Enables impact analysis, architectural queries, and semantic code search. Remembers everything about your codebase.",
  "author": {
    "name": "The Lobbi",
    "email": "developers@thelobbi.io"
  },
  "license": "MIT",
  "repository": "https://github.com/Lobbi-Docs/claude",
  "keywords": [
    "knowledge-graph", "semantic", "graph-database", "code-understanding",
    "impact-analysis", "dependency-graph", "call-graph", "data-flow",
    "architectural-patterns", "domain-model", "entity-relationship",
    "code-search", "semantic-search", "codebase-memory", "neo4j"
  ],

  "graphTypes": {
    "call-graph": {
      "name": "Call Graph",
      "description": "Function/method call relationships",
      "nodes": ["function", "method", "class"],
      "edges": ["calls", "called-by", "overrides"]
    },
    "dependency-graph": {
      "name": "Dependency Graph",
      "description": "Module and package dependencies",
      "nodes": ["module", "package", "class"],
      "edges": ["imports", "depends-on", "provides"]
    },
    "data-flow-graph": {
      "name": "Data Flow Graph",
      "description": "Data movement through the system",
      "nodes": ["variable", "parameter", "return-value", "field"],
      "edges": ["flows-to", "transforms-into", "derived-from"]
    },
    "inheritance-graph": {
      "name": "Inheritance Graph",
      "description": "Class hierarchy and interface implementation",
      "nodes": ["class", "interface", "trait"],
      "edges": ["extends", "implements", "mixes-in"]
    },
    "event-graph": {
      "name": "Event Graph",
      "description": "Event publishing and subscription",
      "nodes": ["event", "publisher", "subscriber", "handler"],
      "edges": ["publishes", "subscribes-to", "handles"]
    },
    "api-graph": {
      "name": "API Graph",
      "description": "API endpoints and their relationships",
      "nodes": ["endpoint", "controller", "service", "model"],
      "edges": ["routes-to", "uses", "returns", "accepts"]
    },
    "domain-graph": {
      "name": "Domain Model Graph",
      "description": "Business domain entities and relationships",
      "nodes": ["entity", "value-object", "aggregate", "repository"],
      "edges": ["contains", "references", "owns", "manages"]
    },
    "architecture-graph": {
      "name": "Architecture Graph",
      "description": "High-level architectural components",
      "nodes": ["service", "component", "layer", "module"],
      "edges": ["communicates-with", "depends-on", "contains"]
    }
  },

  "analysisCapabilities": {
    "impactAnalysis": {
      "name": "Impact Analysis",
      "description": "What is affected when X changes",
      "queries": [
        "what-uses-this",
        "what-breaks-if-changed",
        "affected-tests",
        "affected-endpoints"
      ]
    },
    "pathAnalysis": {
      "name": "Path Analysis",
      "description": "How does data/control flow from A to B",
      "queries": [
        "shortest-path",
        "all-paths",
        "data-path",
        "control-path"
      ]
    },
    "patternDetection": {
      "name": "Pattern Detection",
      "description": "Identifies architectural patterns in code",
      "patterns": [
        "singleton", "factory", "observer", "repository",
        "service-layer", "saga", "cqrs", "event-sourcing"
      ]
    },
    "anomalyDetection": {
      "name": "Anomaly Detection",
      "description": "Finds unusual patterns suggesting issues",
      "anomalies": [
        "circular-dependency",
        "orphan-code",
        "god-class",
        "feature-envy",
        "shotgun-surgery"
      ]
    },
    "semanticSearch": {
      "name": "Semantic Code Search",
      "description": "Natural language search across codebase",
      "features": [
        "concept-search",
        "similar-code",
        "example-finder",
        "pattern-matching"
      ]
    }
  },

  "commands": {
    "graph:build": "commands/build.md",
    "graph:query": "commands/query.md",
    "graph:impact": "commands/impact.md",
    "graph:path": "commands/path.md",
    "graph:search": "commands/search.md",
    "graph:patterns": "commands/patterns.md",
    "graph:anomalies": "commands/anomalies.md",
    "graph:visualize": "commands/visualize.md",
    "graph:explain": "commands/explain.md",
    "graph:compare": "commands/compare.md",
    "graph:diff": "commands/diff.md",
    "graph:export": "commands/export.md",
    "graph:update": "commands/update.md",
    "graph:stats": "commands/stats.md",
    "graph:status": "commands/status.md"
  },

  "agents": {
    "graph-builder-agent": {
      "path": "agents/graph-builder-agent.md",
      "model": "sonnet",
      "description": "Builds and maintains the knowledge graph",
      "triggers": ["build graph", "index codebase", "analyze structure"]
    },
    "impact-analyzer-agent": {
      "path": "agents/impact-analyzer-agent.md",
      "model": "sonnet",
      "description": "Analyzes change impact across the codebase",
      "triggers": ["impact analysis", "what affects", "change impact"]
    },
    "path-finder-agent": {
      "path": "agents/path-finder-agent.md",
      "model": "haiku",
      "description": "Finds paths between code entities",
      "triggers": ["find path", "how does", "trace from"]
    },
    "semantic-search-agent": {
      "path": "agents/semantic-search-agent.md",
      "model": "sonnet",
      "description": "Natural language search over the knowledge graph",
      "triggers": ["find code that", "where is", "search for"]
    },
    "pattern-detector-agent": {
      "path": "agents/pattern-detector-agent.md",
      "model": "sonnet",
      "description": "Detects architectural patterns in code",
      "triggers": ["find patterns", "detect architecture", "what pattern"]
    },
    "anomaly-detector-agent": {
      "path": "agents/anomaly-detector-agent.md",
      "model": "sonnet",
      "description": "Detects code smells and architectural issues",
      "triggers": ["find issues", "detect problems", "code smells"]
    },
    "architecture-explainer-agent": {
      "path": "agents/architecture-explainer-agent.md",
      "model": "opus",
      "description": "Explains system architecture using the graph",
      "triggers": ["explain architecture", "how does system work", "overview"]
    },
    "domain-mapper-agent": {
      "path": "agents/domain-mapper-agent.md",
      "model": "sonnet",
      "description": "Maps domain concepts to code entities",
      "triggers": ["domain model", "business concepts", "where is logic for"]
    },
    "dependency-analyst-agent": {
      "path": "agents/dependency-analyst-agent.md",
      "model": "haiku",
      "description": "Analyzes dependencies and coupling",
      "triggers": ["dependencies", "coupling", "what depends on"]
    },
    "graph-visualizer-agent": {
      "path": "agents/graph-visualizer-agent.md",
      "model": "haiku",
      "description": "Creates visualizations of graph subsets",
      "triggers": ["visualize", "show graph", "diagram"]
    },
    "history-tracker-agent": {
      "path": "agents/history-tracker-agent.md",
      "model": "haiku",
      "description": "Tracks how the graph changes over time",
      "triggers": ["graph history", "how has changed", "evolution"]
    }
  },

  "skills": {
    "graph-construction": {
      "path": "skills/graph-construction.md",
      "description": "Building knowledge graphs from code",
      "triggers": ["build graph", "construct", "index"]
    },
    "graph-querying": {
      "path": "skills/graph-querying.md",
      "description": "Querying knowledge graphs (Cypher, SPARQL)",
      "triggers": ["query graph", "cypher", "sparql"]
    },
    "impact-analysis": {
      "path": "skills/impact-analysis.md",
      "description": "Change impact and blast radius analysis",
      "triggers": ["impact", "blast radius", "affected by"]
    },
    "pattern-recognition": {
      "path": "skills/pattern-recognition.md",
      "description": "Architectural pattern detection",
      "triggers": ["pattern", "architecture", "structure"]
    },
    "semantic-understanding": {
      "path": "skills/semantic-understanding.md",
      "description": "Semantic code understanding and search",
      "triggers": ["semantic", "meaning", "concept"]
    },
    "graph-visualization": {
      "path": "skills/graph-visualization.md",
      "description": "Graph visualization techniques",
      "triggers": ["visualize", "diagram", "graph viz"]
    },
    "domain-modeling": {
      "path": "skills/domain-modeling.md",
      "description": "Domain-driven design and modeling",
      "triggers": ["domain", "ddd", "bounded context"]
    }
  },

  "hooks": {
    "postCodeChange": {
      "script": "hooks/scripts/incremental-update.sh",
      "description": "Incrementally updates graph on code changes"
    },
    "prePR": {
      "script": "hooks/scripts/impact-report.sh",
      "description": "Generates impact report for PR changes"
    },
    "onQuery": {
      "script": "hooks/scripts/query-logging.sh",
      "description": "Logs queries for analytics and optimization"
    },
    "onBuild": {
      "script": "hooks/scripts/build-completion.sh",
      "description": "Actions after graph build completion"
    }
  },

  "graphEngine": {
    "backend": "in-memory",
    "supportedBackends": ["in-memory", "neo4j", "dgraph", "json-file"],
    "persistPath": ".claude/knowledge-graph/",
    "incrementalUpdates": true,
    "maxNodes": 1000000,
    "maxEdges": 10000000
  },

  "permissions": {
    "filesystem": [
      { "path": "**/*", "access": "read" },
      { "path": ".claude/knowledge-graph/**", "access": "readwrite" }
    ],
    "tools": ["Bash", "Read", "Grep", "Glob", "Task"],
    "mcpServers": []
  },

  "configuration": {
    "schema": {
      "type": "object",
      "properties": {
        "backend": {
          "type": "string",
          "enum": ["in-memory", "neo4j", "dgraph", "json-file"],
          "default": "json-file"
        },
        "autoUpdate": {
          "type": "boolean",
          "default": true
        },
        "includeTests": {
          "type": "boolean",
          "default": true
        },
        "maxDepth": {
          "type": "number",
          "default": 10,
          "description": "Max depth for path queries"
        },
        "excludePatterns": {
          "type": "array",
          "items": { "type": "string" },
          "default": ["node_modules", "dist", "build", ".git"]
        }
      }
    }
  },

  "activation": {
    "auto": true,
    "priority": 850,
    "conditions": {
      "keywords": [
        "graph", "impact", "dependency", "what uses", "affected by",
        "find code", "where is", "how does", "architecture", "pattern"
      ]
    }
  }
}
