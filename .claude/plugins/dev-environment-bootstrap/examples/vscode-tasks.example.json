{
  "//": "=============================================================================",
  "//": "VSCode Tasks - Generated by Bootstrap Plugin",
  "//": "Tech Stack: Next.js 14 + FastAPI + PostgreSQL + Redis",
  "//": "=============================================================================",

  "version": "2.0.0",
  "tasks": [
    // === Docker Tasks ===
    {
      "label": "Docker: Start All Services",
      "type": "shell",
      "command": "docker-compose up -d",
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "dedicated"
      },
      "group": {
        "kind": "build",
        "isDefault": false
      }
    },
    {
      "label": "Docker: Stop All Services",
      "type": "shell",
      "command": "docker-compose down",
      "problemMatcher": []
    },
    {
      "label": "Docker: Restart All Services",
      "type": "shell",
      "command": "docker-compose restart",
      "problemMatcher": []
    },
    {
      "label": "Docker: View Logs",
      "type": "shell",
      "command": "docker-compose logs -f",
      "problemMatcher": [],
      "isBackground": true
    },
    {
      "label": "Docker: Rebuild All",
      "type": "shell",
      "command": "docker-compose up -d --build",
      "problemMatcher": []
    },

    // === Frontend (Next.js) Tasks ===
    {
      "label": "Frontend: Install Dependencies",
      "type": "shell",
      "command": "npm install",
      "options": {
        "cwd": "${workspaceFolder}/frontend"
      },
      "problemMatcher": []
    },
    {
      "label": "Frontend: Dev Server",
      "type": "npm",
      "script": "dev",
      "path": "frontend/",
      "problemMatcher": "$tsc-watch",
      "isBackground": true,
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "group": "dev"
      }
    },
    {
      "label": "Frontend: Build",
      "type": "npm",
      "script": "build",
      "path": "frontend/",
      "group": {
        "kind": "build",
        "isDefault": true
      },
      "problemMatcher": ["$tsc"]
    },
    {
      "label": "Frontend: Lint",
      "type": "npm",
      "script": "lint",
      "path": "frontend/",
      "problemMatcher": ["$eslint-stylish"]
    },
    {
      "label": "Frontend: Type Check",
      "type": "shell",
      "command": "tsc --noEmit",
      "options": {
        "cwd": "${workspaceFolder}/frontend"
      },
      "problemMatcher": ["$tsc"]
    },
    {
      "label": "Frontend: Format",
      "type": "npm",
      "script": "format",
      "path": "frontend/",
      "problemMatcher": []
    },
    {
      "label": "Frontend: Test",
      "type": "npm",
      "script": "test",
      "path": "frontend/",
      "problemMatcher": []
    },
    {
      "label": "Frontend: Test (Watch)",
      "type": "npm",
      "script": "test:watch",
      "path": "frontend/",
      "isBackground": true,
      "problemMatcher": []
    },

    // === Backend (FastAPI) Tasks ===
    {
      "label": "Backend: Install Dependencies",
      "type": "shell",
      "command": "pip install -r requirements.txt",
      "options": {
        "cwd": "${workspaceFolder}/backend"
      },
      "problemMatcher": []
    },
    {
      "label": "Backend: Dev Server",
      "type": "shell",
      "command": "uvicorn main:app --reload --host 0.0.0.0 --port 8000",
      "options": {
        "cwd": "${workspaceFolder}/backend"
      },
      "isBackground": true,
      "problemMatcher": {
        "pattern": {
          "regexp": "^(.*)$",
          "file": 1,
          "location": 2,
          "message": 3
        },
        "background": {
          "activeOnStart": true,
          "beginsPattern": ".*Uvicorn running.*",
          "endsPattern": ".*Application startup complete.*"
        }
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "group": "dev"
      }
    },
    {
      "label": "Backend: Lint",
      "type": "shell",
      "command": "ruff check .",
      "options": {
        "cwd": "${workspaceFolder}/backend"
      },
      "problemMatcher": []
    },
    {
      "label": "Backend: Format",
      "type": "shell",
      "command": "ruff format .",
      "options": {
        "cwd": "${workspaceFolder}/backend"
      },
      "problemMatcher": []
    },
    {
      "label": "Backend: Type Check",
      "type": "shell",
      "command": "mypy .",
      "options": {
        "cwd": "${workspaceFolder}/backend"
      },
      "problemMatcher": []
    },
    {
      "label": "Backend: Test",
      "type": "shell",
      "command": "pytest -v",
      "options": {
        "cwd": "${workspaceFolder}/backend"
      },
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "problemMatcher": []
    },
    {
      "label": "Backend: Test (Watch)",
      "type": "shell",
      "command": "pytest-watch",
      "options": {
        "cwd": "${workspaceFolder}/backend"
      },
      "isBackground": true,
      "problemMatcher": []
    },
    {
      "label": "Backend: Coverage",
      "type": "shell",
      "command": "pytest --cov=. --cov-report=html",
      "options": {
        "cwd": "${workspaceFolder}/backend"
      },
      "problemMatcher": []
    },

    // === Database Tasks ===
    {
      "label": "Database: Run Migrations",
      "type": "shell",
      "command": "alembic upgrade head",
      "options": {
        "cwd": "${workspaceFolder}/backend"
      },
      "problemMatcher": []
    },
    {
      "label": "Database: Create Migration",
      "type": "shell",
      "command": "alembic revision --autogenerate -m \"${input:migrationName}\"",
      "options": {
        "cwd": "${workspaceFolder}/backend"
      },
      "problemMatcher": []
    },
    {
      "label": "Database: Rollback Migration",
      "type": "shell",
      "command": "alembic downgrade -1",
      "options": {
        "cwd": "${workspaceFolder}/backend"
      },
      "problemMatcher": []
    },
    {
      "label": "Database: Seed Data",
      "type": "shell",
      "command": "python scripts/seed.py",
      "options": {
        "cwd": "${workspaceFolder}/backend"
      },
      "problemMatcher": []
    },
    {
      "label": "Database: Reset (Danger!)",
      "type": "shell",
      "command": "docker-compose down -v && docker-compose up -d postgres && sleep 5 && alembic upgrade head",
      "problemMatcher": []
    },

    // === Combined Development Tasks ===
    {
      "label": "Dev: Start All",
      "dependsOn": [
        "Docker: Start All Services",
        "Frontend: Dev Server",
        "Backend: Dev Server"
      ],
      "dependsOrder": "sequence",
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "dedicated"
      }
    },
    {
      "label": "Dev: Lint All",
      "dependsOn": [
        "Frontend: Lint",
        "Backend: Lint"
      ],
      "dependsOrder": "parallel",
      "problemMatcher": []
    },
    {
      "label": "Dev: Format All",
      "dependsOn": [
        "Frontend: Format",
        "Backend: Format"
      ],
      "dependsOrder": "parallel",
      "problemMatcher": []
    },
    {
      "label": "Dev: Test All",
      "dependsOn": [
        "Frontend: Test",
        "Backend: Test"
      ],
      "dependsOrder": "parallel",
      "group": {
        "kind": "test",
        "isDefault": false
      },
      "problemMatcher": []
    },
    {
      "label": "Dev: Build All",
      "dependsOn": [
        "Frontend: Build",
        "Backend: Lint"
      ],
      "dependsOrder": "parallel",
      "group": {
        "kind": "build",
        "isDefault": false
      },
      "problemMatcher": []
    },

    // === CI/CD Preview Tasks ===
    {
      "label": "CI: Pre-commit Checks",
      "dependsOn": [
        "Dev: Lint All",
        "Dev: Type Check All",
        "Dev: Test All"
      ],
      "dependsOrder": "sequence",
      "problemMatcher": []
    },
    {
      "label": "Dev: Type Check All",
      "dependsOn": [
        "Frontend: Type Check",
        "Backend: Type Check"
      ],
      "dependsOrder": "parallel",
      "problemMatcher": []
    },

    // === Cleanup Tasks ===
    {
      "label": "Cleanup: node_modules",
      "type": "shell",
      "command": "rm -rf frontend/node_modules",
      "problemMatcher": []
    },
    {
      "label": "Cleanup: Python Cache",
      "type": "shell",
      "command": "find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true",
      "problemMatcher": []
    },
    {
      "label": "Cleanup: Docker Volumes",
      "type": "shell",
      "command": "docker-compose down -v",
      "problemMatcher": []
    },
    {
      "label": "Cleanup: All",
      "dependsOn": [
        "Cleanup: node_modules",
        "Cleanup: Python Cache",
        "Cleanup: Docker Volumes"
      ],
      "dependsOrder": "parallel",
      "problemMatcher": []
    },

    // === Utility Tasks ===
    {
      "label": "Open: API Docs",
      "type": "shell",
      "command": "open http://localhost:8000/docs || xdg-open http://localhost:8000/docs || start http://localhost:8000/docs",
      "problemMatcher": []
    },
    {
      "label": "Open: Frontend",
      "type": "shell",
      "command": "open http://localhost:3000 || xdg-open http://localhost:3000 || start http://localhost:3000",
      "problemMatcher": []
    },
    {
      "label": "Open: pgAdmin",
      "type": "shell",
      "command": "open http://localhost:5050 || xdg-open http://localhost:5050 || start http://localhost:5050",
      "problemMatcher": []
    },
    {
      "label": "Check: Environment",
      "type": "shell",
      "command": "node --version && npm --version && python --version && docker --version && docker-compose --version",
      "problemMatcher": []
    }
  ],

  "//": "=============================================================================",
  "//": "Input Variables",
  "//": "=============================================================================",
  "inputs": [
    {
      "id": "migrationName",
      "type": "promptString",
      "description": "Migration name (e.g., add_user_table)"
    }
  ],

  "//": "=============================================================================",
  "//": "Usage Instructions",
  "//": "=============================================================================",
  "//": "",
  "//": "Run tasks from Command Palette:",
  "//": "  • Cmd/Ctrl+Shift+P → 'Tasks: Run Task'",
  "//": "",
  "//": "Quick Start:",
  "//": "  • Run 'Dev: Start All' to start everything",
  "//": "",
  "//": "Keyboard Shortcuts (add to keybindings.json):",
  "//": "  {",
  "//": "    'key': 'cmd+shift+b',",
  "//": "    'command': 'workbench.action.tasks.runTask',",
  "//": "    'args': 'Dev: Build All'",
  "//": "  },",
  "//": "  {",
  "//": "    'key': 'cmd+shift+t',",
  "//": "    'command': 'workbench.action.tasks.runTask',",
  "//": "    'args': 'Dev: Test All'",
  "//": "  }",
  "//": "",
  "//": "============================================================================="
}
